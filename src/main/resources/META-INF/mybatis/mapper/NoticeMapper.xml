<?xml version="1.0" encoding="UTF-8"?>
<!--

       Copyright 2009-2016 the original author or authors.

       Licensed under the Apache License, Version 2.0 (the "License");
       you may not use this file except in compliance with the License.
       You may obtain a copy of the License at

          http://www.apache.org/licenses/LICENSE-2.0

       Unless required by applicable law or agreed to in writing, software
       distributed under the License is distributed on an "AS IS" BASIS,
       WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
       See the License for the specific language governing permissions and
       limitations under the License.

-->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.akanemurakawa.kaguya.dao.mapper.NoticeMapper">
  <!-- author: HanaeYuuma -->
  <resultMap id="WithAdminResultMap" type="com.hanaeyuuma.freeblogs.model.Notice">
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="admin_id" jdbcType="INTEGER" property="adminId" />
    <result column="notice_title" jdbcType="VARCHAR" property="noticeTitle" />
    <result column="notice_date" jdbcType="TIMESTAMP" property="noticeDate" />
    <result column="notice_sumary" jdbcType="VARCHAR" property="noticeSumary" />
    <result column="notice_content" jdbcType="LONGVARCHAR" property="noticeContent" />
    <association property="admin" javaType="com.hanaeyuuma.freeblogs.model.Admin">
	    <id column="id" jdbcType="INTEGER" property="id" />
	    <result column="admin_name" jdbcType="VARCHAR" property="adminName" />
    </association>
  </resultMap>
  
  <resultMap id="BaseResultMap" type="com.hanaeyuuma.freeblogs.model.Notice">
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="admin_id" jdbcType="INTEGER" property="adminId" />
    <result column="notice_title" jdbcType="VARCHAR" property="noticeTitle" />
    <result column="notice_date" jdbcType="TIMESTAMP" property="noticeDate" />
    <result column="notice_sumary" jdbcType="VARCHAR" property="noticeSumary" />
  </resultMap>
  <resultMap extends="BaseResultMap" id="ResultMapWithBLOBs" type="com.hanaeyuuma.freeblogs.model.Notice">
    <result column="notice_content" jdbcType="LONGVARCHAR" property="noticeContent" />
  </resultMap>
  
  <!-- author: HanaeYuuma -->
  <sql id="With_Admin_Column_List">
    n.id, n.admin_id, n.notice_title, n.notice_date, n.notice_sumary, n.notice_content, a.id, a.admin_name
  </sql>
  
  <sql id="Base_Column_List">
    id, admin_id, notice_title, notice_date, notice_sumary
  </sql>
  <sql id="Blob_Column_List">
    notice_content
  </sql>
  
  <!-- author: HanaeYuuma --> 
  <!-- 查看最新的一篇公告，显示在home界面 -->
  <select id="selectRecentOneOrderByDate" resultMap="WithAdminResultMap">
    select 
    <include refid="With_Admin_Column_List" />
    from freeblogs_notice n left join freeblogs_admin a on n.admin_id = a.id
    order by n.notice_date desc limit 1
  </select>
  
  <!-- author: HanaeYuuma -->
  <!-- 查询所有公告，并带有管理员信息 -->
  <select id="selectAllWithAdmin" resultMap="WithAdminResultMap">
    select 
    <include refid="With_Admin_Column_List" />
    from freeblogs_notice n left join freeblogs_admin a on n.admin_id = a.id
    order by n.notice_date desc
  </select>
   
  <!-- author: HanaeYuuma -->
  <!-- 查询一篇公告，并带有管理员信息 -->
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="WithAdminResultMap">
    select 
    <include refid="With_Admin_Column_List" />
    from freeblogs_notice n left join freeblogs_admin a on n.admin_id = a.id
    where n.id = #{id,jdbcType=INTEGER}
  </select>
  
  <!-- author: HanaeYuuma -->
  <!-- 查询公告标题是否存在 -->
  <select id="selectTitleById" parameterType="java.lang.Integer" resultType="java.lang.String">
    select notice_title from freeblogs_notice where  id= #{id,jdbcType=INTEGER}
  </select>  
  
  <!-- author: HanaeYuuma -->
  <!-- 查询公告id -->
  <select id="selectIdByTitle" parameterType="java.lang.String" resultType="java.lang.Integer">
    select id from freeblogs_notice where notice_title = #{noticeTitle,jdbcType=VARCHAR}
  </select>

  <!-- author: HanaeYuuma -->
  <!-- 插入公告 -->  
  <insert id="insert" parameterType="com.hanaeyuuma.freeblogs.model.Notice">
    insert into freeblogs_notice (admin_id, notice_title, notice_sumary, notice_content)
    values (#{adminId,jdbcType=INTEGER}, #{noticeTitle,jdbcType=VARCHAR}, #{noticeSumary,
    jdbcType=VARCHAR}, #{noticeContent,jdbcType=LONGVARCHAR})
  </insert>
  
  <!-- author: HanaeYuuma -->
  <!-- 单个删除公告 -->
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    delete from freeblogs_notice
    where id = #{id,jdbcType=INTEGER}
  </delete>
  
  <!-- author: HanaeYuuma -->
  <!-- 批处理删除公告 -->
  <delete id="batchDeleteByPrimaryKey" parameterType="java.util.List">
    delete from freeblogs_notice
    where id in
    <foreach collection="list" item="item" open="(" separator="," close=")">
    	#{item}
    </foreach>
  </delete>
  
  <!-- author: HanaeYuuma -->
  <!-- 更新公告 -->  
  <update id="updateByPrimaryKey" parameterType="com.hanaeyuuma.freeblogs.model.Notice">
    update freeblogs_notice
    set notice_title = #{noticeTitle,jdbcType=VARCHAR}, notice_sumary = #{noticeTitle,jdbcType=VARCHAR},
    notice_content = #{noticeContent,jdbcType=LONGVARCHAR}
    where id = #{id,jdbcType=INTEGER}
  </update>  
  <!-- 以下待使用 -->


  <insert id="insertSelective" parameterType="com.hanaeyuuma.freeblogs.model.Notice">
    insert into freeblogs_notice
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="id != null">
        id,
      </if>
      <if test="adminId != null">
        admin_id,
      </if>
      <if test="noticeTitle != null">
        notice_title,
      </if>
      <if test="noticeDate != null">
        notice_date,
      </if>
      <if test="noticeSumary != null">
        notice_sumary,
      </if>
      <if test="noticeContent != null">
        notice_content,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="id != null">
        #{id,jdbcType=INTEGER},
      </if>
      <if test="adminId != null">
        #{adminId,jdbcType=INTEGER},
      </if>
      <if test="noticeTitle != null">
        #{noticeTitle,jdbcType=VARCHAR},
      </if>
      <if test="noticeDate != null">
        #{noticeDate,jdbcType=TIMESTAMP},
      </if>
      <if test="noticeSumary != null">
        #{noticeSumary,jdbcType=VARCHAR},
      </if>
      <if test="noticeContent != null">
        #{noticeContent,jdbcType=LONGVARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.hanaeyuuma.freeblogs.model.Notice">
    update freeblogs_notice
    <set>
      <if test="adminId != null">
        admin_id = #{adminId,jdbcType=INTEGER},
      </if>
      <if test="noticeTitle != null">
        notice_title = #{noticeTitle,jdbcType=VARCHAR},
      </if>
      <if test="noticeDate != null">
        notice_date = #{noticeDate,jdbcType=TIMESTAMP},
      </if>
      <if test="noticeSumary != null">
        notice_sumary = #{noticeSumary,jdbcType=VARCHAR},
      </if>
      <if test="noticeContent != null">
        notice_content = #{noticeContent,jdbcType=LONGVARCHAR},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKeyWithBLOBs" parameterType="com.hanaeyuuma.freeblogs.model.Notice">
    update freeblogs_notice
    set admin_id = #{adminId,jdbcType=INTEGER},
      notice_title = #{noticeTitle,jdbcType=VARCHAR},
      notice_date = #{noticeDate,jdbcType=TIMESTAMP},
      notice_sumary = #{noticeSumary,jdbcType=VARCHAR},
      notice_content = #{noticeContent,jdbcType=LONGVARCHAR}
    where id = #{id,jdbcType=INTEGER}
  </update>

</mapper>