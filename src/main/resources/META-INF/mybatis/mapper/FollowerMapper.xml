<?xml version="1.0" encoding="UTF-8"?>
<!--

       Copyright 2009-2016 the original author or authors.

       Licensed under the Apache License, Version 2.0 (the "License");
       you may not use this file except in compliance with the License.
       You may obtain a copy of the License at

          http://www.apache.org/licenses/LICENSE-2.0

       Unless required by applicable law or agreed to in writing, software
       distributed under the License is distributed on an "AS IS" BASIS,
       WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
       See the License for the specific language governing permissions and
       limitations under the License.2

-->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.akanemurakawa.kaguya.dao.mapper.FollowerMapper">
  <resultMap id="BaseResultMap" type="com.hanaeyuuma.freeblogs.model.Follower">
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="user_id" jdbcType="INTEGER" property="userId" />
    <result column="following_id" jdbcType="INTEGER" property="followingId" />
  </resultMap>
  <sql id="Base_Column_List">
    id, user_id, following_id
  </sql>
  
  <!-- author:HanaeYuuma -->
  <!-- 查看用户关注的人 -->
  <select id="selectFollowing" parameterType="java.lang.Integer" resultType="java.lang.Integer">
    select following_id from freeblogs_follower
    where user_id = #{userId,jdbcType=INTEGER}
  </select>
  
  <!-- author:HanaeYuuma -->
  <!-- 查看粉丝，关注用户的人 -->
  <select id="selectFollower" parameterType="java.lang.Integer" resultType="java.lang.Integer">
    select user_id from freeblogs_follower
    where following_id = #{followingId,jdbcType=INTEGER}
  </select>
  
  <!-- author:HanaeYuuma -->
  <!-- 点击关注 -->
  <insert id="insert" useGeneratedKeys="true" parameterType="com.hanaeyuuma.freeblogs.model.Follower">
    insert into freeblogs_follower (user_id, following_id)
    values (#{userId,jdbcType=INTEGER}, #{followingId,jdbcType=INTEGER}
      )
  </insert>
  
  <!-- author:HanaeYuuma -->
  <!-- 取消关注或移除粉丝 -->
  <delete id="delete" parameterType="com.hanaeyuuma.freeblogs.model.Follower">
    delete from freeblogs_follower
    where user_id = #{userId,jdbcType=INTEGER} and 
    following_id = #{followingId,jdbcType=INTEGER}
  </delete>
  
  <!-- author:HanaeYuuma -->
  <!-- 是否是粉丝或者是否关注 -->
  <select id="isFollow" parameterType="com.hanaeyuuma.freeblogs.model.Follower" resultType="java.lang.Integer">
    select id from freeblogs_follower
    where user_id = #{userId,jdbcType=INTEGER} and following_id = #{followingId,jdbcType=INTEGER}
  </select>
  
  <!-- 以下待使用 -->
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    select 
    <include refid="Base_Column_List" />
    from freeblogs_follower
    where id = #{id,jdbcType=INTEGER}
  </select>

  <insert id="insertSelective" parameterType="com.hanaeyuuma.freeblogs.model.Follower">
    insert into freeblogs_follower
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="id != null">
        id,
      </if>
      <if test="userId != null">
        admin_name,
      </if>
      <if test="followingId != null">
        admin_password,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="id != null">
        #{id,jdbcType=INTEGER},
      </if>
      <if test="userId != null">
        #{userId,jdbcType=INTEGER},
      </if>
      <if test="followingId != null">
        #{followingId,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.hanaeyuuma.freeblogs.model.Follower">
    update freeblogs_follower
    <set>
      <if test="userId != null">
        admin_name = #{userId,jdbcType=INTEGER},
      </if>
      <if test="followingId != null">
        admin_password = #{followingId,jdbcType=INTEGER},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.hanaeyuuma.freeblogs.model.Follower">
    update freeblogs_follower
    set admin_name = #{userId,jdbcType=INTEGER},
      admin_password = #{followingId,jdbcType=INTEGER}
    where id = #{id,jdbcType=INTEGER}
  </update>
</mapper>